name: Fetch YOM

on:
  schedule:
    - cron: '0 1 * * *'  # Run every day at 1:00 AM
  workflow_dispatch:

jobs:
  fetch-and-save:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2
      with:
        submodules: 'recursive'

    - name: Use Node.js 16
      uses: actions/setup-node@v2
      with:
        node-version: '16'

    - name: Fetch and Save XML Files
      run: |
        mkdir -p xml_yom_$(date +\%Y\%m)
        for i in {0..7}
        do
          if [ $i -eq 0 ]
          then
            url="https://www.yomiuri.co.jp/sitemap-news-latest.xml"
            suffix="latest"
          else
            url="https://www.yomiuri.co.jp/sitemap-news-past-$i.xml"
            suffix="past-$i"
          fi
          wget $url -O "xml_yom_$(date +\%Y\%m)/xml-yom_$(date +\%Y\%m%d)_$suffix.xml"
        done

    - name: Commit files
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git checkout -b update-xml-files
        git add xml_yom_$(date +\%Y\%m)/*
        git commit -m "Add XML files for $(date +\%Y\%m%d)"
        git push origin update-xml-files
